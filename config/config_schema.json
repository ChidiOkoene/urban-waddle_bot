{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Trading Bot Configuration Schema",
  "type": "object",
  "properties": {
    "exchange": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ccxt", "mt5"]
        },
        "name": {
          "type": "string"
        },
        "credentials": {
          "type": "object",
          "properties": {
            "api_key": {"type": "string"},
            "secret": {"type": "string"},
            "password": {"type": "string"},
            "sandbox": {"type": "boolean"}
          },
          "required": ["api_key", "secret"]
        }
      },
      "required": ["type", "credentials"]
    },
    "trading": {
      "type": "object",
      "properties": {
        "symbols": {
          "type": "array",
          "items": {"type": "string"}
        },
        "timeframe": {
          "type": "string",
          "enum": ["1m", "5m", "15m", "30m", "1h", "4h", "1d", "1w", "1M"]
        },
        "mode": {
          "type": "string",
          "enum": ["paper", "live", "dry-run"]
        },
        "max_positions": {"type": "integer", "minimum": 1},
        "update_interval": {"type": "integer", "minimum": 1}
      },
      "required": ["symbols", "timeframe", "mode"]
    },
    "strategy": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "enum": ["rsi_macd", "bollinger", "ema_crossover", "grid", "dca", "breakout", "momentum", "ichimoku", "arbitrage"]
        },
        "parameters": {"type": "object"},
        "use_ml_filter": {"type": "boolean"},
        "ml_threshold": {"type": "number", "minimum": 0, "maximum": 1}
      },
      "required": ["name"]
    },
    "risk": {
      "type": "object",
      "properties": {
        "max_risk_per_trade": {"type": "number", "minimum": 0, "maximum": 1},
        "max_positions": {"type": "integer", "minimum": 1},
        "position_sizing": {
          "type": "string",
          "enum": ["kelly", "fixed_fractional", "volatility_based"]
        },
        "stop_loss_type": {
          "type": "string",
          "enum": ["atr", "percentage", "trailing", "parabolic_sar"]
        },
        "stop_loss_atr_multiplier": {"type": "number", "minimum": 0},
        "stop_loss_percentage": {"type": "number", "minimum": 0, "maximum": 1},
        "take_profit_ratio": {"type": "number", "minimum": 0},
        "trailing_stop_activation": {"type": "number", "minimum": 0, "maximum": 1},
        "trailing_stop_distance": {"type": "number", "minimum": 0, "maximum": 1},
        "max_drawdown": {"type": "number", "minimum": 0, "maximum": 1},
        "correlation_limit": {"type": "number", "minimum": 0, "maximum": 1}
      },
      "required": ["max_risk_per_trade", "max_positions", "position_sizing", "stop_loss_type"]
    },
    "backtesting": {
      "type": "object",
      "properties": {
        "start_date": {"type": "string", "format": "date"},
        "end_date": {"type": "string", "format": "date"},
        "initial_capital": {"type": "number", "minimum": 0},
        "commission": {"type": "number", "minimum": 0},
        "slippage": {"type": "number", "minimum": 0},
        "walk_forward_periods": {"type": "integer", "minimum": 1},
        "optimization_method": {
          "type": "string",
          "enum": ["grid", "genetic", "bayesian"]
        }
      },
      "required": ["start_date", "end_date", "initial_capital"]
    },
    "dashboard": {
      "type": "object",
      "properties": {
        "port": {"type": "integer", "minimum": 1, "maximum": 65535},
        "host": {"type": "string"},
        "update_interval": {"type": "integer", "minimum": 1},
        "enable_notifications": {"type": "boolean"},
        "theme": {"type": "string", "enum": ["dark", "light"]},
        "chart_height": {"type": "integer", "minimum": 100},
        "max_candles": {"type": "integer", "minimum": 100}
      }
    },
    "notifications": {
      "type": "object",
      "properties": {
        "telegram": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "bot_token": {"type": "string"},
            "chat_id": {"type": "string"}
          }
        },
        "discord": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "webhook_url": {"type": "string"}
          }
        },
        "email": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "smtp_server": {"type": "string"},
            "smtp_port": {"type": "integer"},
            "username": {"type": "string"},
            "password": {"type": "string"},
            "to_address": {"type": "string"}
          }
        }
      }
    },
    "logging": {
      "type": "object",
      "properties": {
        "level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR"]
        },
        "file": {"type": "string"},
        "max_size": {"type": "integer", "minimum": 0},
        "backup_count": {"type": "integer", "minimum": 0},
        "format": {"type": "string"}
      }
    },
    "database": {
      "type": "object",
      "properties": {
        "url": {"type": "string"},
        "pool_size": {"type": "integer", "minimum": 1},
        "max_overflow": {"type": "integer", "minimum": 0},
        "echo": {"type": "boolean"}
      }
    },
    "ml": {
      "type": "object",
      "properties": {
        "models": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["random_forest", "xgboost", "lightgbm"]
          }
        },
        "features": {
          "type": "array",
          "items": {"type": "string"}
        },
        "target_horizon": {"type": "integer", "minimum": 1},
        "train_interval": {"type": "integer", "minimum": 1},
        "validation_split": {"type": "number", "minimum": 0, "maximum": 1},
        "min_samples": {"type": "integer", "minimum": 1}
      }
    }
  },
  "required": ["exchange", "trading", "strategy", "risk"]
}
